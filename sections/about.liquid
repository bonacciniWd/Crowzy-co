{% comment %}
  Seção About - ScrollSmoother Effect with GSAP
  Baseado no CodePen oficial: https://codepen.io/GreenSock/pen/xxXadQJ
{% endcomment %}

<h1 class="text">{{ section.settings.main_text | default: "Scrolly Images" }}</h1>
<h1 aria-hidden="true" class="text outline-text">{{ section.settings.main_text | default: "Scrolly Images" }}</h1>
<h1 aria-hidden="true" class="text filter-text">{{ section.settings.main_text | default: "Scrolly Images" }}</h1>

<div id="wrapper-{{ section.id }}">
  <section id="content-{{ section.id }}">
    <section class="images">
      {% comment %} Renderizar imagens com configurações do schema {% endcomment %}
      {% assign fallback_urls = 'https://images.unsplash.com/photo-1556856425-366d6618905d?ixid=MnwxMjA3fDB8MHxzZWFyY2h8MTV8fG5lb258ZW58MHx8MHx8&ixlib=rb-1.2.1&auto=format&fit=crop&w=400&q=60,https://images.unsplash.com/photo-1520271348391-049dd132bb7c?ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&ixlib=rb-1.2.1&auto=format&fit=crop&w=400&q=80,https://images.unsplash.com/photo-1609166214994-502d326bafee?ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&ixlib=rb-1.2.1&auto=format&fit=crop&w=400&q=80,https://images.unsplash.com/photo-1589882265634-84f7eb9a3414?ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&ixlib=rb-1.2.1&auto=format&fit=crop&w=434&q=80,https://images.unsplash.com/photo-1514689832698-319d3bcac5d5?ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&ixlib=rb-1.2.1&auto=format&fit=crop&w=434&q=80,https://images.unsplash.com/photo-1535207010348-71e47296838a?ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&ixlib=rb-1.2.1&auto=format&fit=crop&w=300&q=80,https://images.unsplash.com/photo-1588007375246-3ee823ef4851?ixid=MnwxMjA3fDB8MHxzZWFyY2h8MjR8fG5lb258ZW58MHx8MHx8&ixlib=rb-1.2.1&auto=format&fit=crop&w=400&q=60,https://images.unsplash.com/photo-1571450669798-fcb4c543f6a4?ixid=MnwxMjA3fDB8MHxzZWFyY2h8MjF8fG5lb258ZW58MHx8MHx8&ixlib=rb-1.2.1&auto=format&fit=crop&w=400&q=60' | split: ',' %}
      {% assign fallback_speeds = '0.8,0.9,1.0,1.1,0.9,1.2,0.8,1.0' | split: ',' %}
      
      {% for i in (1..8) %}
        {% assign image_key = 'image_' | append: i %}
        {% assign image = section.settings[image_key] %}
        {% assign speed_key = 'speed_' | append: i %}
        {% assign speed = section.settings[speed_key] | default: fallback_speeds[forloop.index0] %}
        
        {% if image != blank %}
          <img 
            data-speed="{{ speed }}" 
            src="{{ image | image_url: width: 600 }}" 
            alt="{{ image.alt | escape }}"
          >
        {% else %}
          {% assign fallback_index = forloop.index0 %}
          {% assign fallback_url = fallback_urls[fallback_index] %}
          <img 
            data-speed="{{ speed }}" 
            src="{{ fallback_url }}" 
            alt=""
          >
        {% endif %}
      {% endfor %}
    </section>
  </section>
</div>

<style>
  body {
    margin: 0;
    background-color: {{ section.settings.background_color | default: '#1a1721' }};
    color: white;
    overscroll-behavior: none;
    margin: 0;
    padding: 0;
    overflow-x: hidden;
  }

  #wrapper-{{ section.id }} {
    overflow: hidden;
    position: flex;
    height: 100%;
    width: 100%;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
  }

  #content-{{ section.id }} {
    overflow: visible;
    width: 100%;
    position: relative;
  }

  .text {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-family: {{ section.settings.font_family | default: 'termina, sans-serif' }};
    font-weight: 900;
    font-style: normal;
    font-size: clamp(4rem, {{ section.settings.text_size | default: 8 }}vw, 12rem);
    text-align: center;
    width: 100%;
    margin: 0;
    line-height: 1;
    z-index: 2;
    color: {{ section.settings.text_color | default: 'white' }};
    -webkit-text-stroke-width: {{ section.settings.text_stroke_width | default: 1.5 }}px;
    -webkit-text-stroke-color: {{ section.settings.text_stroke_color | default: 'white' }};
    pointer-events: none;
  }

  .text:first-child {
    z-index: -2;
  }

  .outline-text {
    color: transparent;
    -webkit-text-stroke-width: {{ section.settings.text_stroke_width | default: 1.5 }}px;
    -webkit-text-stroke-color: {{ section.settings.text_stroke_color | default: 'white' }};
    z-index: 2;
  }

  .filter-text {
    mix-blend-mode: {{ section.settings.blend_mode | default: 'screen' }};
    color: {{ section.settings.filter_text_color | default: '#804691' }};
    z-index: 2;
  }

  .images {
    padding: 80vh 0;
    position: relative;
    width: 100%;
    max-width: {{ section.settings.max_width | default: 1200 }}px;
    margin: 0 auto;
    min-height: 150vh;
    height: 100%;
    display: grid;
    grid-template-columns: repeat(20, 5%);
    grid-template-rows: repeat(40, 20px);
    justify-content: center;
    justify-items: center;
    align-items: center;
  }

  .images img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: {{ section.settings.image_border_radius | default: 0 }}px;
    transition: transform 0.3s ease;
  }

  .images img:hover {
    transform: scale({{ section.settings.hover_scale | default: 1.05 }});
  }

  /* Posicionamento das imagens no grid - exatamente como no CodePen */
  .images img:nth-child(1) {
    grid-area: 1/1/10/8;
  }

  .images img:nth-child(2) {
    grid-area: 5/12/15/20;
  }

  .images img:nth-child(3) {
    grid-area: 12/5/20/15;
  }

  .images img:nth-child(4) {
    grid-area: 18/1/25/8;
  }

  .images img:nth-child(5) {
    grid-area: 22/12/28/19;
  }

  .images img:nth-child(6) {
    grid-area: 26/2/33/9;
  }

  .images img:nth-child(7) {
    grid-area: 30/11/35/20;
  }

  .images img:nth-child(8) {
    grid-area: 33/5/39/15;
  }

  /* Responsividade */
  @media (max-width: 768px) {
    .text {
      font-size: clamp(2rem, 6vw, 4rem);
      -webkit-text-stroke-width: 1px;
    }

    .images {
      grid-template-columns: repeat(10, 10%);
      grid-template-rows: repeat(50, 15px);
      padding: 60vh 0;
      min-height: 200vh;
    }

    .images img:nth-child(1) {
      grid-area: 1/1/8/6;
    }

    .images img:nth-child(2) {
      grid-area: 5/6/12/10;
    }

    .images img:nth-child(3) {
      grid-area: 10/2/16/8;
    }

    .images img:nth-child(4) {
      grid-area: 14/1/20/5;
    }

    .images img:nth-child(5) {
      grid-area: 18/6/24/10;
    }

    .images img:nth-child(6) {
      grid-area: 22/2/28/7;
    }

    .images img:nth-child(7) {
      grid-area: 26/6/30/10;
    }

    .images img:nth-child(8) {
      grid-area: 30/2/36/8;
    }
  }
</style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollSmoother.min.js"></script>

<script>
  // Código baseado exatamente no CodePen oficial do GSAP
  document.addEventListener('DOMContentLoaded', function() {
    if (typeof gsap === 'undefined') {
      console.error('GSAP não está carregado');
      return;
    }

    gsap.registerPlugin(ScrollTrigger, ScrollSmoother);

    requestAnimationFrame(() => {
      const sectionId = '{{ section.id }}';
      
      try {
        // Exatamente como no CodePen original
        let skewSetter = gsap.quickTo("img", "skewY"); // fast
        let clamp = gsap.utils.clamp(-20, 20); // don't let the skew go beyond 20 degrees.

        ScrollSmoother.create({
          wrapper: `#wrapper-${sectionId}`,
          content: `#content-${sectionId}`,
          smooth: {{ section.settings.smooth_strength | default: 2 }},
          speed: {{ section.settings.scroll_speed | default: 3 }},
          effects: true,
          onUpdate: self => skewSetter(clamp(self.getVelocity() / -50)),
          onStop: () => skewSetter(0)
        });

        console.log('ScrollSmoother inicializado com sucesso');

      } catch (error) {
        console.error('Erro ao inicializar ScrollSmoother:', error);
      }
    });
  });
</script>

{% schema %}
{
  "name": "About - ScrollSmoother",
  "tag": "section",
  "class": "about-section",
  "settings": [
    {
      "type": "header",
      "content": "Configurações Gerais"
    },
    {
      "type": "text",
      "id": "main_text",
      "label": "Texto Principal",
      "default": "Scrolly Images",
      "info": "Texto que aparece flutuando sobre as imagens"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Cor de Fundo",
      "default": "#1a1721"
    },
    {
      "type": "header",
      "content": "Configurações do Texto"
    },
    {
      "type": "range",
      "id": "text_size",
      "label": "Tamanho do Texto (vw)",
      "min": 4,
      "max": 15,
      "step": 0.5,
      "default": 8
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Cor do Texto",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "text_stroke_color",
      "label": "Cor do Contorno",
      "default": "#ffffff"
    },
    {
      "type": "range",
      "id": "text_stroke_width",
      "label": "Largura do Contorno",
      "min": 0.5,
      "max": 3,
      "step": 0.1,
      "default": 1.5
    },
    {
      "type": "color",
      "id": "filter_text_color",
      "label": "Cor do Filtro de Texto",
      "default": "#804691"
    },
    {
      "type": "select",
      "id": "blend_mode",
      "label": "Modo de Mistura",
      "options": [
        { "value": "normal", "label": "Normal" },
        { "value": "screen", "label": "Screen" },
        { "value": "overlay", "label": "Overlay" },
        { "value": "multiply", "label": "Multiply" },
        { "value": "difference", "label": "Difference" }
      ],
      "default": "screen"
    },
    {
      "type": "text",
      "id": "font_family",
      "label": "Família da Fonte",
      "default": "termina, sans-serif",
      "info": "Ex: 'Helvetica, sans-serif' ou nome de fonte do Google Fonts"
    },
    {
      "type": "header",
      "content": "Configurações das Imagens"
    },
    {
      "type": "range",
      "id": "max_width",
      "label": "Largura Máxima do Container (px)",
      "min": 800,
      "max": 1600,
      "step": 50,
      "default": 1200
    },
    {
      "type": "range",
      "id": "image_border_radius",
      "label": "Raio da Borda das Imagens",
      "min": 0,
      "max": 30,
      "step": 1,
      "default": 0
    },    {
      "type": "range",
      "id": "hover_scale",
      "label": "Escala no Hover",
      "min": 1.0,
      "max": 1.2,
      "step": 0.1,
      "default": 1.1
    },
    {
      "type": "header",
      "content": "Configurações do ScrollSmoother"
    },
    {
      "type": "range",
      "id": "smooth_strength",
      "label": "Força da Suavização",
      "min": 0.5,
      "max": 5,
      "step": 0.1,
      "default": 2
    },
    {
      "type": "range",
      "id": "scroll_speed",
      "label": "Velocidade do Scroll",
      "min": 0.5,
      "max": 5,
      "step": 0.1,
      "default": 3
    },
    {
      "type": "header",
      "content": "Imagens do Grid"
    },
    {
      "type": "image_picker",
      "id": "image_1",
      "label": "Imagem 1"
    },
    {
      "type": "range",
      "id": "speed_1",
      "label": "Velocidade Parallax 1",
      "min": 0.1,
      "max": 2,
      "step": 0.1,
      "default": 0.8
    },
    {
      "type": "image_picker",
      "id": "image_2",
      "label": "Imagem 2"
    },
    {
      "type": "range",
      "id": "speed_2",
      "label": "Velocidade Parallax 2",
      "min": 0.1,
      "max": 2,
      "step": 0.1,
      "default": 0.9
    },
    {
      "type": "image_picker",
      "id": "image_3",
      "label": "Imagem 3"
    },
    {
      "type": "range",
      "id": "speed_3",
      "label": "Velocidade Parallax 3",
      "min": 0.1,
      "max": 2,
      "step": 0.1,
      "default": 1.0
    },
    {
      "type": "image_picker",
      "id": "image_4",
      "label": "Imagem 4"
    },
    {
      "type": "range",
      "id": "speed_4",
      "label": "Velocidade Parallax 4",
      "min": 0.1,
      "max": 2,
      "step": 0.1,
      "default": 1.1
    },
    {
      "type": "image_picker",
      "id": "image_5",
      "label": "Imagem 5"
    },
    {
      "type": "range",
      "id": "speed_5",
      "label": "Velocidade Parallax 5",
      "min": 0.1,
      "max": 2,
      "step": 0.1,
      "default": 0.9
    },
    {
      "type": "image_picker",
      "id": "image_6",
      "label": "Imagem 6"
    },
    {
      "type": "range",
      "id": "speed_6",
      "label": "Velocidade Parallax 6",
      "min": 0.1,
      "max": 2,
      "step": 0.1,
      "default": 1.2
    },
    {
      "type": "image_picker",
      "id": "image_7",
      "label": "Imagem 7"
    },
    {
      "type": "range",
      "id": "speed_7",
      "label": "Velocidade Parallax 7",
      "min": 0.1,
      "max": 2,
      "step": 0.1,
      "default": 0.8
    },
    {
      "type": "image_picker",
      "id": "image_8",
      "label": "Imagem 8"
    },
    {
      "type": "range",
      "id": "speed_8",
      "label": "Velocidade Parallax 8",
      "min": 0.1,
      "max": 2,
      "step": 0.1,
      "default": 1.0
    }
  ],
  "presets": [
    {
      "name": "About ScrollSmoother",
      "category": "Interactive"
    }
  ]
}
{% endschema %}
